<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Implementing SlidingDFTs · SlidingDFTs.jl</title><meta name="title" content="Implementing SlidingDFTs · SlidingDFTs.jl"/><meta property="og:title" content="Implementing SlidingDFTs · SlidingDFTs.jl"/><meta property="twitter:title" content="Implementing SlidingDFTs · SlidingDFTs.jl"/><meta name="description" content="Documentation for SlidingDFTs.jl."/><meta property="og:description" content="Documentation for SlidingDFTs.jl."/><meta property="twitter:description" content="Documentation for SlidingDFTs.jl."/><meta property="og:url" content="https://heliosdrm.github.io/SlidingDFTs.jl/implement/"/><meta property="twitter:url" content="https://heliosdrm.github.io/SlidingDFTs.jl/implement/"/><link rel="canonical" href="https://heliosdrm.github.io/SlidingDFTs.jl/implement/"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">SlidingDFTs.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li class="is-active"><a class="tocitem" href>Implementing SlidingDFTs</a><ul class="internal"><li><a class="tocitem" href="#Theoretical-basis"><span>Theoretical basis</span></a></li><li><a class="tocitem" href="#Implementation-in-object-types"><span>Implementation in object types</span></a></li><li><a class="tocitem" href="#Extract-information-from-the-state-of-SDFT-iterators"><span>Extract information from the state of SDFT iterators</span></a></li><li class="toplevel"><a class="tocitem" href="#Definition-of-new-SDFT-types"><span>Definition of new SDFT types</span></a></li></ul></li><li><a class="tocitem" href="../api/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Implementing SlidingDFTs</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Implementing SlidingDFTs</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/heliosdrm/SlidingDFTs.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/heliosdrm/SlidingDFTs.jl/blob/main/docs/src/implement.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Impementing-SlidingDFTs"><a class="docs-heading-anchor" href="#Impementing-SlidingDFTs">Impementing SlidingDFTs</a><a id="Impementing-SlidingDFTs-1"></a><a class="docs-heading-anchor-permalink" href="#Impementing-SlidingDFTs" title="Permalink"></a></h1><p>SlidingDFTs provides an interface to define new methods to compute Sliding Discrete Fourier Transforms (SDFT), which can be implemented in pull requests to this package, but also in independent packages.</p><h2 id="Theoretical-basis"><a class="docs-heading-anchor" href="#Theoretical-basis">Theoretical basis</a><a id="Theoretical-basis-1"></a><a class="docs-heading-anchor-permalink" href="#Theoretical-basis" title="Permalink"></a></h2><p>A SDFT is generally implemented as a recursive equation, such that if <span>$X_{i}[k]$</span> is the DFT of <span>$x[j]$</span> for <span>$j = i, \ldots, i+n$</span> at frequency <span>$k$</span>, the next iteration is:</p><p class="math-container">\[X_{i+1}[k] = f(X_{i}[k], X_{i-1}[k], \ldots, X_{1}[k], x[i], \ldots x[i+n], x[i+n+1])\]</p><p>Such an equation depends on:</p><ul><li>The values of the DFT in one or more previous iterations, <span>$X_{p}[k]$</span> for <span>$p = 1, \ldots, i$</span>.</li><li>The values of the data series used in the most recent iteration, <span>$x[j]$</span> for <span>$j = i, \ldots, i+n$</span>.</li><li>The next value of the data series after the fragment used in the most recent iteration, <span>$x[i+n+1]$</span>.</li></ul><p>For instance, the <a href="https://www.researchgate.net/publication/3321463_The_sliding_DFT">basic definition of the SDFT</a> uses the following formula: </p><p class="math-container">\[X_{i+1}[k] = W[k] \cdot (X_{i}[k] + x[i+n] - x[i]),\]</p><p>which depends only on the most recent DFT (<span>$X_{i}[k]$</span>), the first data point of the fragment used in that DFT (<span>$x[i]$</span>), and the next data point after that fragment (<span>$x[i+n+1]$</span>), plus a &quot;twiddle&quot; factor <span>$W[k]$</span> that only depends on the frequency <span>$k$</span>, equal to <span>$exp(j2{\pi}k/n)$</span>. Other variations of the SDFT may use formulas that depend on previous iterations or other values of the data series in that fragment.</p><h2 id="Implementation-in-object-types"><a class="docs-heading-anchor" href="#Implementation-in-object-types">Implementation in object types</a><a id="Implementation-in-object-types-1"></a><a class="docs-heading-anchor-permalink" href="#Implementation-in-object-types" title="Permalink"></a></h2><p>A method to compute an SDFT is defined by three kinds of object types:</p><ul><li>One for the method, which contains the fixed parameters that are needed by the algorithm to compute the SDFT.</li><li>Another for the iterator created by the functions <code>sdft</code> or <code>stateful_sdft</code>, which binds a method with the target data series.</li><li>And another for the state of the iterator, which complements the method with the variable information that changes at each iteration.</li></ul><p>The internals of SlidingDFTs take care of the design of the iterator and state types and the creation of their instances. The only thing that has to be defined to create a new kind of SDFT is the <code>struct</code> of the method with the fixed parameters, and a few function methods that dispatching on that type. One of those functions is the one that implements the recursive formula, using also the information stored in the state.</p><h2 id="Extract-information-from-the-state-of-SDFT-iterators"><a class="docs-heading-anchor" href="#Extract-information-from-the-state-of-SDFT-iterators">Extract information from the state of SDFT iterators</a><a id="Extract-information-from-the-state-of-SDFT-iterators-1"></a><a class="docs-heading-anchor-permalink" href="#Extract-information-from-the-state-of-SDFT-iterators" title="Permalink"></a></h2><p>Before explaining how to define a new type for SDFTs, it is convenient to know the functions that can be used to extract the information that is stored in the state of SDFT iterators. There is a function for each of the three kinds of variables used in the general recursive equation presented above.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="SlidingDFTs.previousdft-implement" href="#SlidingDFTs.previousdft-implement"><code>SlidingDFTs.previousdft</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">previousdft(state[, back=0])</code></pre><p>Return the DFT computed in the most recent iteration of the sliding DFT represented by <code>state</code>, or in a number of previous iterations equal to <code>back</code>.</p><p>If the most recent iteration computed the DFT of the fragment of a data series corresponding to the range <code>i : i+n</code>, then this function returns its DFT for the range <code>i-back : i+n-back</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/heliosdrm/SlidingDFTs.jl/blob/8c0d3e60ae79606c2b89fb254e79377f518bc16f/src/interface.jl#L149-L159">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="SlidingDFTs.previousdata-implement" href="#SlidingDFTs.previousdata-implement"><code>SlidingDFTs.previousdata</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">previousdata(state[, offset=0])</code></pre><p>Return the first value of the fragment of the data series that was used in the most recent iteration of the sliding DFT represented by <code>state</code>, or at <code>offset</code> positions after the beginning of that fragment.</p><p>If the most recent iteration computed the DFT of the fragment of a data series corresponding to the range <code>i : i+n</code>, then this function returns its <code>i+offset</code>-th value.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/heliosdrm/SlidingDFTs.jl/blob/8c0d3e60ae79606c2b89fb254e79377f518bc16f/src/interface.jl#L126-L135">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="SlidingDFTs.nextdata-implement" href="#SlidingDFTs.nextdata-implement"><code>SlidingDFTs.nextdata</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">nextdata(state)</code></pre><p>Return the next value after the fragment of the data series that was used in the most recent iteration of the sliding DFT represented by <code>state</code>.</p><p>If the most recent iteration computed the DFT of the fragment of a data series corresponding to the range <code>i : i+n</code>, then this function returns its <code>i+n+1</code>-th value.</p><p>There is no defined behavior if such value does not exist (i.e. if the end of a finite data series was reached).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/heliosdrm/SlidingDFTs.jl/blob/8c0d3e60ae79606c2b89fb254e79377f518bc16f/src/interface.jl#L171-L182">source</a></section></article><p>For instance, the values used in the formula of the basic SDFT may be obtained from a <code>state</code> object as:</p><ul><li><code>SlidingDFTs.previousdft(state, 0)</code> for <span>$X_{i}$</span>.</li><li><code>SlidingDFTs.previousdata(state, 0)</code> for <span>$x[i]$</span>.</li><li><code>SlidingDFTs.nextdata(state)</code> for <span>$x[i+n+1]$</span>.</li></ul><p>Notice that the second argument of <code>previousdft</code> and <code>previousdata</code> might have been ommited in this case, since it is zero by default.</p><p>For methods that need to know how many steps of the SDFT have been done, this can also be extracted:</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="SlidingDFTs.iterationcount-implement" href="#SlidingDFTs.iterationcount-implement"><code>SlidingDFTs.iterationcount</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">iterationcount(state)</code></pre><p>Return the number of iterations done for the sliding DFT represented by <code>state</code>.</p><p>If the most recent iteration computed the DFT of the fragment of <code>x</code> corresponding to the range <code>i : i+n</code>, then this function returns  the number <code>i</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/heliosdrm/SlidingDFTs.jl/blob/8c0d3e60ae79606c2b89fb254e79377f518bc16f/src/interface.jl#L185-L192">source</a></section></article><h1 id="Definition-of-new-SDFT-types"><a class="docs-heading-anchor" href="#Definition-of-new-SDFT-types">Definition of new SDFT types</a><a id="Definition-of-new-SDFT-types-1"></a><a class="docs-heading-anchor-permalink" href="#Definition-of-new-SDFT-types" title="Permalink"></a></h1><p>The design of the <code>struct</code> representing a new SDFT type is free, but it is required to implement the following functions dispatching on that type:</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="SlidingDFTs.windowlength-implement" href="#SlidingDFTs.windowlength-implement"><code>SlidingDFTs.windowlength</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">SlidingDFTs.windowlength(method)</code></pre><p>Return the length of the window used by <code>method</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/heliosdrm/SlidingDFTs.jl/blob/8c0d3e60ae79606c2b89fb254e79377f518bc16f/src/interface.jl#L8-L12">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="SlidingDFTs.updatedft!-implement" href="#SlidingDFTs.updatedft!-implement"><code>SlidingDFTs.updatedft!</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">updatedft!(dft, x, method, state)</code></pre><p>Update the values of a sliding Discrete Fourier Transform (DFT) of a data series, according to the algorithm of the provided method, for a given state of the sliding DFT.</p><p><code>dft</code> is a mutable collection of complex values with length equal to <code>windowlength(method)</code>, containing the value returned by the last iteration of the sliding DFT.</p><p><code>x</code> is the data series for which the sliding DFT is computed, at least as long as <code>windowlength(method)</code>.</p><p><code>method</code> is the object that defines the method to compute the sliding DFT.</p><p><code>state</code> is an object generated automatically at each iteration of an object created by <code>sdft(method, x)</code> or <code>stateful_sdft(method, x)</code>, containing the information that is needed to compute the new values of the sliding DFT, together with <code>x</code>. That information can be extracted from <code>state</code> with the following functions:</p><ul><li><code>SlidingDFTs.nextdata</code>(@ref) to get the next value of the data series.</li><li><code>SlidingDFTs.previousdata</code>(@ref) to get a previous value of the data series.</li><li><code>SlidingDFTs.previousdft</code>(@ref) to get the DFTs of previous iterations.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/heliosdrm/SlidingDFTs.jl/blob/8c0d3e60ae79606c2b89fb254e79377f518bc16f/src/interface.jl#L15-L37">source</a></section></article><p>The formula of the basic SDFT formula could be implemented for a type <code>MyBasicSDFT</code> as follows:</p><pre><code class="language-julia hljs">import SlidingDFTs: updatedft!, windowlength, nextdata, previousdata

function udpatedft!(dft, x, method::MyBasicSDFT, state)
    n = windowlength(method)
    for k in eachindex(dft)
        X_i = dft[k]
        x_iplusn = nextdata(state)
        x_i = previousdata(state)
        Wk = exp(2π*im*k/n)
        dft[k] = Wk * (X_i + x_iplusn - x_i)
    end
end</code></pre><p>(The type [<code>SDFT</code>]@ref implemented in <code>SlidingDFTs</code> actually has as a similar, but not identic definition.)</p><p>Notice that it was not necessary to use <code>previousdft</code> to retrieve the most recent iteration of the DFT, since that is assummed to be already contained in the first argument <code>dft</code>.</p><p>Depending on the functions that are used in the particular implementation of <code>updatepdf!</code> for a given type, the following methods should be defined too:</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="SlidingDFTs.dataoffsets-implement" href="#SlidingDFTs.dataoffsets-implement"><code>SlidingDFTs.dataoffsets</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">dataoffsets(method)</code></pre><p>Return an integer or a vector of integers with the offsets of data samples that are needed by the given method to compute a sliding DFT.</p><p>If the code of <code>SlidingDFTs.updatepdf!</code> that dispatches on the type of <code>method</code> uses the function <code>SlidingDFTs.previousdata</code>, this function must return the integers that are used as the third argument (<code>offset</code>) of that function. If that function is not needed (no past samples are used), this one may return <code>nothing</code> to reduce memory allocations.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/heliosdrm/SlidingDFTs.jl/blob/8c0d3e60ae79606c2b89fb254e79377f518bc16f/src/interface.jl#L42-L51">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="SlidingDFTs.dftback-implement" href="#SlidingDFTs.dftback-implement"><code>SlidingDFTs.dftback</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">dftback(method)</code></pre><p>Return an integer or a vector of positive integers with the indices of the previous iterations that are needed by the given method to compute a sliding DFT.</p><p>If the code of <code>SlidingDFTs.updatepdf!</code> for the type of <code>method</code> uses the function <code>SlidingDFTs.previousdft</code>, this function must return the integers that are used as the third argument (<code>back</code>) of that function.</p><p>If that function is not needed, this one may return <code>nothing</code> to reduce memory allocations.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/heliosdrm/SlidingDFTs.jl/blob/8c0d3e60ae79606c2b89fb254e79377f518bc16f/src/interface.jl#L54-L64">source</a></section></article><p>The fallback methods of those functions return <code>nothing</code>, as if neither <code>previousdata</code> or <code>previousdft</code> had to be used.</p><p>The implementation of <code>updatepdf!</code> given in the previous example does use <code>previousdata</code> - with the default offset value, equal to zero - so the following is required in this case:</p><pre><code class="language-julia hljs">SlidingDFTs.dataoffsets(::MyBasicSDFT) = 0</code></pre><p>On the other hand there is no need to define <code>SlidingDFTs.dftback</code> in this case, since as it has been noted above, the interface of of <code>updatedft!</code> assumes that the most recent DFT is already contained in its first argument, soit is not necessary to use the function <code>previousdft</code> to get it.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Home</a><a class="docs-footer-nextpage" href="../api/">API »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.0 on <span class="colophon-date" title="Sunday 1 December 2024 12:13">Sunday 1 December 2024</span>. Using Julia version 1.11.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
